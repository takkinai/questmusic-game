<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scales Practice - QuestMusic</title>
  <style>
    body {
      background-color: #121212;
      color: white;
      text-align: center;
      font-family: sans-serif;
      padding: 20px;
    }
    h1 {
      color: #00ffc8;
    }
    .container {
      margin-top: 50px;
      background-color: #1f1f1f;
      padding: 20px;
      border-radius: 10px;
      display: inline-block;
    }
    select, button {
      padding: 10px 20px;
      background: #00ffea;
      color: black;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      margin: 5px;
    }
    button:hover, select:hover {
      background: #00c4b4;
    }
    .note-display {
      font-size: 3rem;
      margin-top: 20px;
      color: #00ffc8;
    }
  </style>
</head>
<body>

  <h1>üé∑ Scales Practice - QuestMusic</h1>

  <div class="container">
    <h2 id="username">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, ...</h2>

    <p>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡πÄ‡∏Å‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏ù‡∏∂‡∏Å:</p>
    <select id="scale-select">
      <option value="C Major">C Major</option>
      <option value="G Major">G Major</option>
      <option value="D Major">D Major</option>
      <option value="A Major">A Major</option>
      <option value="E Major">E Major</option>
      <option value="F Major">F Major</option>
      <option value="Bb Major">Bb Major</option>
    </select>

    <br><br>
    <button onclick="startPractice()">üéß ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ù‡∏∂‡∏Å</button>
    <button onclick="stopPractice()">‚èπÔ∏è ‡∏´‡∏¢‡∏∏‡∏î</button>
    <br>
    <button onclick="goTo('profile.html')">üè† ‡∏Å‡∏•‡∏±‡∏ö Profile</button>
    <button onclick="logout()">üö™ Logout</button>

    <div class="note-display" id="note-display">üéµ ...</div>
  </div>

  <script>
    const username = localStorage.getItem('quest_username');
    const usernameEl = document.getElementById('username');
    const noteDisplay = document.getElementById('note-display');

    if (!username) {
      alert('‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ Login! ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤ Login...');
      window.location.href = 'login.html';
    } else {
      usernameEl.textContent = `‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ, ${username} üé∂`;
    }

    function goTo(page) {
      window.location.href = page;
    }

    function logout() {
      const confirmLogout = confirm('‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?');
      if (confirmLogout) {
        localStorage.removeItem('quest_username');
        window.location.href = 'login.html';
      }
    }

    // üî• ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏ö‡πÄ‡∏™‡∏µ‡∏¢‡∏á (Demo Version)
    let audioContext, analyser, microphone, javascriptNode;

    function startPractice() {
      noteDisplay.textContent = 'üéß Listening...';

      navigator.mediaDevices.getUserMedia({ audio: true })
        .then(function(stream) {
          audioContext = new (window.AudioContext || window.webkitAudioContext)();
          analyser = audioContext.createAnalyser();
          microphone = audioContext.createMediaStreamSource(stream);
          javascriptNode = audioContext.createScriptProcessor(2048, 1, 1);

          analyser.smoothingTimeConstant = 0.8;
          analyser.fftSize = 2048;

          microphone.connect(analyser);
          analyser.connect(javascriptNode);
          javascriptNode.connect(audioContext.destination);

          javascriptNode.onaudioprocess = function() {
            const array = new Uint8Array(analyser.frequencyBinCount);
            analyser.getByteFrequencyData(array);

            const average = array.reduce((a, b) => a + b) / array.length;
            
            if (average > 20) {
              const note = detectFakeNote(); // üî• ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÇ‡∏ô‡πâ‡∏ï
              noteDisplay.textContent = `üéµ ${note}`;
            }
          };
        })
        .catch(function(err) {
          alert('‚ö†Ô∏è ‡∏ï‡πâ‡∏≠‡∏á‡∏≠‡∏ô‡∏∏‡∏ç‡∏≤‡∏ï‡πÉ‡∏´‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πÇ‡∏Ñ‡∏£‡πÇ‡∏ü‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ù‡∏∂‡∏Å!');
